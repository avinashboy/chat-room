const socket=io.connect("https://hot-c.herokuapp.com"),insertHere=document.getElementById("insertHere"),replyPreview=document.getElementById("replyPreview"),replyCloseHide=document.getElementById("replyCloseHide"),rigth=document.getElementById("right"),closeHide=document.getElementById("closeHide"),img=document.getElementById("img"),title=document.getElementById("title"),description=document.getElementById("description"),site=document.getElementById("site"),linkPreview=document.getElementById("link-preview"),output=document.getElementById("output"),message=document.getElementById("message"),handle=document.getElementById("name"),send=document.getElementById("send"),left=document.getElementById("left"),feedback=document.getElementById("feedback"),copys=document.getElementById("copy"),sub=document.getElementById("sub"),deletes=document.getElementById("delete"),room=document.getElementById("roomname"),sticker=document.querySelectorAll(".sticker"),set_password=document.getElementById("set_password"),file_upload_here=document.getElementById("file_upload_here"),show_user_list=document.getElementById("show_user_list");let keys,hide,passsword,xhr,switchs=document.getElementById("switch"),darkMode=localStorage.getItem("darkMode"),dis=document.getElementById("dis"),isdis=document.getElementById("isdis"),j=0,gettingIn=0,gettingInn=0,goDownToPage=0,set_up="",tempDataOne=null,tempDataTwo=null,tempId=null,linkUrl="",status=!1,reply_state=!1;req_state=!1;let emoji=[],delete_list=[];const change_mode=document.getElementById("change_mode");var checkbox=document.querySelector("input[name=theme]");function truncate(e,t){return e.split(" ").splice(0,t).join(" ")}function firstName(e){let t=e===handle.value?"you":e;return t.charAt(0).toUpperCase()+t.slice(1)}function replyComment(e,t,n,s,d){return tempDataOne=n,tempDataTwo=s,$(d).parent().parent().removeClass("add_bg"),$("#keywords").fadeIn(),$("#show_case").fadeOut(),n?s?`<div class="replyHide" id="replyHide" style="border-left: 2px solid ${t};">\n  <div class="replyName" id="replyName" style="color:${t}" > ${firstName(e)} </div>\n    <div class="replyContent replyflex" id="replyContent">\n    <span id="reply" class="replyText">${n}</span>\n    <img src="${s}" alt="" id="replyimg" class="replyImg" />\n    </div>\n  </div>`:`<div class="replyHide" id="replyHide" style="border-left: 2px solid ${t};">\n    <div class="replyName" id="replyName" style="color: ${t};" > ${firstName(e)} </div>\n    <div class="replyContent" id="replyContent">\n      <span id="reply" class="replyText">${n}</span>\n    </div>\n  </div>`:`<div class="replyHide" id="replyHide" style="border-left: 2px solid ${t};">\n    <div class="replyName" id="replyName" style="color: ${t};" > ${firstName(e)} </div>\n    <div class="replyContent" id="replyContent">\n      <img src="${s}" alt="" id="replyimg" class="replyImg" />\n    </div>\n  </div>`}sub.addEventListener("click",()=>{0==handle.value.length?alert("Please enter the name...! "):(socket.emit("list",{room:roomName,handle:handle.value}),room.innerHTML=roomName,"none"===dis.style.display?(dis.style.display="block",isdis.style.display="none"):(dis.style.display="none",isdis.style.display="block"))}),message.addEventListener("keyup",function(e){13===e.keyCode&&(e.preventDefault(),send.click())}),message.addEventListener("keyup",()=>{if(/^(?:(?:https?|ftp?|http):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/.test(message.value)&&2===++gettingIn){gettingIn=0,gettingInn=2;const e="https://abts-link-preview.herokuapp.com";xhr=$.ajax({type:"POST",url:`${e}/api`,data:{Url:message.value},success:function(e){req_state=!0,linkPreview.style.display="block",linkUrl=e.result[0].url,img.src=e.result[0].image,title.innerText=truncate(e.result[0].title,9),site.innerText=e.result[0].site,description.innerText=truncate(e.result[0].description,12)}})}},!1),closeHide.addEventListener("click",()=>{linkPreview.style.display="none",req_state=!1}),replyCloseHide.addEventListener("click",()=>{replyPreview.style.display="none",insertHere.innerHTML=""}),copys.addEventListener("click",()=>{replyPreview.style.display="block",delete_list.map(function(e){let t=colors,n=$(e).parent().children().children()[0].textContent,s=$(e).contents().contents().attr("id");if(tempId=e,"stickerUrl"===s){let s=$(e).contents().contents()[0].src;return void(insertHere.innerHTML+=replyComment(n,t,!1,s,tempId))}if("httpsUrl"===s){let s=$(e).contents().contents().text();return void(insertHere.innerHTML+=replyComment(n,t,s,!1,tempId))}if("user-link-preview"===s){let s=$(e).contents().contents()[0].lastElementChild.textContent,d=$(e).contents().contents()[0].children[0].children[0].src;return void(insertHere.innerHTML+=replyComment(n,t,s,d,tempId))}if("replyHidess"===s){let s=$(e).contents().contents()[2].textContent;if(""===s){let s=$(e).contents().contents()[2].children[0].src;return void(insertHere.innerHTML+=replyComment(n,t,!1,s,tempId))}return void(insertHere.innerHTML+=replyComment(n,t,s,!1,tempId))}if(!s){let s=$(e).contents().contents().text();return void(insertHere.innerHTML+=replyComment(n,t,s,!1,tempId))}}),reply_state=!0,delete_list=[]}),deletes.addEventListener("click",()=>{delete_list.map(function(e){$(e).text(" "),$(e).html('<i class="fas fa-ban"></i> You deleted this message'),$(e).addClass("add_text"),socket.emit("delete",{id:e,room:roomName}),$(e).parent().parent().removeClass("add_bg"),$("#keywords, #copy").fadeIn(),$("#show_case").fadeOut()}),delete_list=[]}),$(document).on("click",".replyHidess",function(){let e=$(this).contents()[3].childNodes[1].id,t=e.split("#");document.getElementById(`${t[1]}`).scrollIntoView();let n=$(`${e}`).parent().parent();$(n).addClass("add_bg"),setTimeout(()=>{$(n).removeClass("add_bg")},2e3)}),$(document).on("click",".rxx",function(){let e=$(`#${$(this)[0].id}`).parent().parent(),t=`#${$(this)[0].id}`;if($(e).hasClass("add_bg")){$(e).removeClass("add_bg");const n=delete_list.indexOf(t);n>-1&&delete_list.splice(n,1),delete_list.length>=1&&($("#keywords").fadeOut(),$("#copy").fadeIn())}else $(e).addClass("add_bg"),delete_list.push(t),$("#keywords").fadeOut(),$("#show_case").fadeIn();delete_list.length>=2&&($("#keywords, #copy").fadeOut(),$("#delete").fadeIn()),0==delete_list&&($("#keywords").fadeIn(),$("#show_case").fadeOut())}),$(".logo").click(()=>{$(".overlay").css({bottom:"0",height:"100%"})}),$(".back").click(()=>{$(".overlay").css({bottom:"100%",height:"0"})});const enableDarkMode=()=>{localStorage.setItem("darkMode","Dark"),darkMode=localStorage.getItem("darkMode"),$("#body").css("background","#333333"),change_mode.innerHTML=darkMode,switchs.checked=!0,$("#mario-chat").css("border","1px solid #212121"),$("#chat-window").css("background","#222831"),$(".inputs").css("border-bottom","1px solid #116979"),document.documentElement.setAttribute("data-theme",darkMode),$(".msger-header").css({background:"#434343",color:"#dbdbdb"})},disableDarkMode=()=>{localStorage.setItem("darkMode","Light"),darkMode=localStorage.getItem("darkMode"),change_mode.innerHTML=darkMode,$("#body").css("background","#fff"),$("#mario-chat").css("border","1px solid #ddd"),switchs.checked=!1,$("#chat-window").css("background","#f9f9f9"),$(".msger-header").css({background:"#eee",color:"#666"}),document.documentElement.setAttribute("data-theme",darkMode)};function set_enr_password(e){return CryptoJS.AES.encrypt(e,passsword).toString()}function set_de_password(e){return CryptoJS.AES.decrypt(e,passsword).toString(CryptoJS.enc.Utf8)}function setme(){if(1==set_password.checked){set_password.checked=!0;let e=prompt("Set the password for room"),t=CryptoJS.SHA256(e);set_up=set_enr_password(t.toString()),status=!0,socket.emit("set_password",{check:!0,room:roomName,handle:handle.value,password:set_up,state:!0})}else{let e=prompt("To remove password "),t=CryptoJS.SHA256(e),n=set_de_password(set_up);t.toString()==n?(set_password.checked=!1,socket.emit("set_password",{check:!1,room:roomName,handle:"none",password:"",state:!1}),status=!1):set_password.checked=!0}}"Dark"===darkMode&&(j+=1,enableDarkMode()),checkbox.addEventListener("change",()=>{0==j?(trans(),enableDarkMode(),j+=1):(trans(),localStorage.setItem("darkMode","Light"),darkMode=localStorage.getItem("darkMode"),change_mode.innerHTML=darkMode,$("#body").css("background","#fff"),$("#mario-chat").css("border","1px solid #ddd"),switchs.checked=!1,$("#chat-window").css("background","#f9f9f9"),$(".msger-header").css({background:"#eee",color:"#666"}),document.documentElement.setAttribute("data-theme",darkMode),j-=1)}),set_password.addEventListener("click",setme);let trans=()=>{document.documentElement.classList.add("transition"),window.setTimeout(()=>{document.documentElement.classList.remove("transition")},1e3)};function msgOrSticker(e){return"raw.githubusercontent.com"==e.split("/")[2]?`<img class="img_sticker" id="stickerUrl" src="${e}"/>`:e}function replyText(e,t,n,s,d,o){return n?s?`<div class="replyHidess" id="replyHidess" style="border-left: 2px solid ${t};">\n  <div class="replyName" id="replyName" style="color:${t}" > ${firstName(e)} </div>\n    <div role="button" class="replyContents replyflex" id="replyContents">\n    <div id="${o}" class="texthide"></div>\n    <span id="reply" class="replyText">${n}</span>\n    <img src="${s}" alt="" id="replyimg" class="replyImg" />\n    </div>\n  </div>\n  <div id="textss" class="textss">${msgOrSticker(d)}</div>`:`<div class="replyHidess" id="replyHidess" style="border-left: 2px solid ${t};">\n    <div class="replyName" id="replyName" style="color: ${t};" > ${firstName(e)} </div>\n    <div role="button class="replyContents" id="replyContents">\n    <div id="${o}" class="texthide"></div>\n      <span id="reply" class="replyText">${n}</span>\n    </div>\n  </div>\n  <div id="textss" class="textss">${msgOrSticker(d)}</div>`:`<div class="replyHidess" id="replyHidess" style="border-left: 2px solid ${t};">\n    <div class="replyName replyNames" id="replyName" style="color: ${t};" > ${firstName(e)} </div>\n    <div role="button" class="replyContents " id="replyContents">\n    <div id="${o}" class="texthide"></div>\n      <img src="${s}" alt="" id="replyimg" class="replyImg" />\n    </div>\n  </div>\n  <div id="textss" class="textss">${msgOrSticker(d)}</div>`}function encrypt(e){return CryptoJS.AES.encrypt(e,keys).toString()}function hide_name(e){return CryptoJS.AES.encrypt(e,hide).toString()}function decr_text(e){return CryptoJS.AES.decrypt(e,keys).toString(CryptoJS.enc.Utf8)}function url_string(e,t,n,s,d,o,i){let r=CryptoJS.AES.decrypt(e,keys).toString(CryptoJS.enc.Utf8);return"raw.githubusercontent.com"===r.split("/")[2]?`<img class="img_sticker" id="stickerUrl" src="${r}"/>`:/^(?:(?:https?|ftp?|http):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/.test(r)?`<a id="httpsUrl" target="_blank" href="${r}">${r}</a>`:"replySticker"===r?(insertHere.innerHTML="",replyText(show_name(t),n,show_name(s),show_name(d),show_name(o),i)):"replyText"===r?(insertHere.innerHTML="",replyText(show_name(t),n,show_name(s),show_name(d),show_name(o),i)):"sending-link-preview"===r?`<div class="user-link-preview" id="user-link-preview">\n          <div class="user-link-hide">\n            <img src="${n}" alt="No image" id="imgUrl"/>\n            <div class="user-link-content">\n              <span>${s}</span>\n              <span> ${d} </span>\n              <span> ${o} </span>\n            </div>\n          </div>\n          <span id="linkUrl">${t}</span>\n        </div>`:"text"===r?decr_text(t):void 0}function show_name(e){return CryptoJS.AES.decrypt(e,hide).toString(CryptoJS.enc.Utf8)}function Firts_letter(e){let t=CryptoJS.AES.decrypt(e,hide).toString(CryptoJS.enc.Utf8);return t.charAt(0).toUpperCase()+t.slice(1)}function getRandomColor(){var e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}function idnumber(){return Math.random().toString(36).substring(7)}let colors=getRandomColor();send.addEventListener("click",function(){0==message.value.length?alert("please enter the text"):(2===gettingInn&&0==req_state&&(xhr.abort(),gettingInn=0),linkPreview.style.display="none",req_state||reply_state||socket.emit("chat",{message:encrypt("text"),handle:hide_name(handle.value),color:colors,id:idnumber(),ids:idnumber(),room:roomName,linkUrl:encrypt(message.value),image:null,title:null,description:null,site:null,replyId:null}),req_state&&(req_state=!1,socket.emit("chat",{message:encrypt("sending-link-preview"),handle:hide_name(handle.value),color:colors,id:idnumber(),ids:idnumber(),room:roomName,linkUrl:linkUrl,image:img.src,title:title.innerText,description:description.innerText,site:site.innerText,replyId:null}),linkUrl=site.innerText=description.innerText=title.innerText="",img.src="#"),reply_state&&(reply_state=!1,replyPreview.style.display="none",socket.emit("chat",{message:encrypt("replyText"),handle:hide_name(handle.value),color:colors,id:idnumber(),ids:idnumber(),room:roomName,linkUrl:hide_name(handle.value),image:colors,title:hide_name(tempDataOne),description:hide_name(tempDataTwo),site:hide_name(message.value),replyId:tempId}),tempDataOne=tempDataTwo=tempId=null))}),message.addEventListener("keypress",function(){socket.emit("typing",{handle:handle.value,room:roomName})}),socket.on("set_password",function(e){set_password.checked=e[roomName].checkbox,$("#note").text(`Password is set by ${e[roomName].who_set}`),set_up=e[roomName].set_password,status=e[roomName].status}),socket.on("status",function(e){if($("#note").text(`Password is set by ${e[roomName].who_set}`),e[roomName].status!=status){let t=set_de_password(set_up=e[roomName].set_password),n=prompt("Enter the paassword for the room"),s=CryptoJS.SHA256(n);set_password.checked=e[roomName].checkbox,s.toString()==t?status=!0:(status=!1,location.reload())}}),socket.on("data_keys",e=>{keys=e.key,hide=e.name,passsword=e.password}),socket.on("chat",function(e){feedback.innerHTML="",left.innerHTML="";let t=(new Date).toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}),n=show_name(e.handle)===handle.value?"right":"left";output.innerHTML+="right"===n?'<div class="msg '+n+'-msg" id="'+e.ids+'" ><div class="msg-bubble"><div class="msg-info"><div class="msg-info-name texthide">'+show_name(e.handle)+'</div></div><div class="msg-text rxx" id="'+e.id+'" ><span id="copyme">'+url_string(e.message,e.linkUrl,e.image,e.title,e.description,e.site,e.replyId)+'</span></div><div class="msg-info-time"><small>'+t+"</small></div></div></div> ":'<div class="msg '+n+'-msg" id="'+e.ids+'" ><div class="msg-bubble"><div class="msg-info"><div class="msg-info-name" style="color:'+e.color+'!important" >'+Firts_letter(e.handle)+'</div></div><div class="msg-text change xxr" id="'+e.id+'" ><span id="copyme">'+url_string(e.message,e.linkUrl,e.image,e.title,e.description,e.site,e.replyId)+'</span></div><div class="msg-info-time"><small>'+t+"</small></div></div></div> ",output.scrollHeight-output.clientHeight<=output.scrollTop+1||(output.scrollTop=output.scrollHeight-output.clientHeight)}),socket.on("typing",e=>{feedback.innerHTML="<p><em>"+e+"  is typing...</em></p>"}),socket.on("user_file",function(e){const t=document.createElement("li"),n=document.createElement("a");n.href=`${e.file}`,n.innerText=`${e.filename}`,n.setAttribute("download",""),t.setAttribute("id",e.id),t.setAttribute("class","file_up"),t.appendChild(n),file_upload_here.appendChild(t)}),socket.on("err_name",e=>{alert(e.message),location.reload()}),socket.on("list_of_user",e=>{let t=[];const n=document.createElement("ul");for(const s in e)if(-1==t.indexOf(e[s])){t.push(e[s]);const d=document.createElement("li");d.innerText=e[s],n.appendChild(d)}show_user_list.innerHTML=" ",show_user_list.appendChild(n)}),socket.on("delete",e=>{$(e).text(" "),$(e).html('<i class="fas fa-ban"></i> This message was deleted'),$(e).addClass("add_texts")}),socket.on("new-user",e=>{left.innerHTML="<p><em>"+e+"</em> is join</p>"}),socket.on("user-disconnect",e=>{null==e||(left.innerHTML="<p><em>"+e+"<em> has left</p>")}),send.addEventListener("click",()=>{message.value=""}),$("#open").click(function(){$(".modal").slideToggle(),$("#other2").fadeOut(),$("#open").fadeOut()}),$("#close").click(function(){$(".modal").slideToggle(),$("#other2").fadeIn(),$("#open").fadeIn()}),$("#open2").click(function(){$(".modal2").slideToggle(),$("#other").fadeOut(),$("#open2").fadeOut()}),$("#close2").click(function(){$(".modal2").slideToggle(),$("#other").fadeIn(),$("#open2").fadeIn()});const all=document.querySelectorAll(".emoji_dislay");function play(e){let t=document.getElementById(e.target.id).textContent;if(-1==emoji.indexOf(t)){emoji.push(t);const e=document.createElement("h2");e.innerText=t,e.setAttribute("id",idnumber()),demo.append(e)}document.getElementById("message").value+=t}function plays(e){reply_state||socket.emit("chat",{message:encrypt(e.target.src),handle:hide_name(handle.value),color:colors,id:idnumber(),ids:idnumber(),room:roomName}),reply_state&&(reply_state=!1,replyPreview.style.display="none",socket.emit("chat",{message:encrypt("replySticker"),handle:hide_name(handle.value),color:colors,id:idnumber(),ids:idnumber(),room:roomName,linkUrl:hide_name(handle.value),image:colors,title:hide_name(tempDataOne),description:hide_name(tempDataTwo),site:hide_name(e.target.src),replyId:tempId}),$(".msg").removeClass("add_bg"),tempDataOne=tempDataTwo=tempId=null)}function getData(e){document.getElementById("emoji_dislay").innerHTML=e.map(function(e){return`<h2 id="${idnumber()}">${e.emoji}</h2>`}).join("")}function call_me(e){document.getElementById("sticker").innerHTML=e.map(function(e){return`<img class="img" src="${e.photo}">`}).join("")}all.forEach(e=>e.addEventListener("click",play)),sticker.forEach(e=>e.addEventListener("click",plays)),$(document).ready(function(){$.getJSON("https://raw.githubusercontent.com/avinashboy/sticker/master/emoji.json",function(e){getData(e)})}),$(document).ready(function(){$.getJSON("https://raw.githubusercontent.com/avinashboy/sticker/master/img.json",function(e){call_me(e[0].data)})}),window.onbeforeunload=function(){return"Are you sure you want to leave?"};var navigating=!1;function navigate(e){navigating=!0,setTimeout(function(){window.location=e},0)}window.onbeforeunload=function(e){return navigating?(navigating=!1,(e=e||window.event)&&(e.returnValue="àààà Are you sure you want to leave?")," àààà Are you sure you want to leave?"):null},window.onload=function(){var e=document.getElementsByTagName("a"),t=function(e){navigate(e.target.getAttribute("data-href"))};for(let n=0;n<e.length;n++)e[n].onclick=t};const url="https://hot-games.herokuapp.com",sockets=io.connect(url),demoo=document.getElementById("demoo"),btns=document.getElementById("btns"),btn_copy=document.getElementById("btn_copy");btns.addEventListener("click",()=>{let e={option:document.getElementById("selected").value};$.ajax({type:"POST",url:`${url}/create`,data:e}),$("#btns").fadeOut(),$("#selected").fadeOut(),$("#show_me").fadeIn()}),sockets.on("new-room",e=>{demoo.value=`${url}/${e}`}),btn_copy.addEventListener("click",()=>{$("#btns").fadeIn(),$("#selected").fadeIn(),$("#show_me").fadeOut()});var clipboard=new ClipboardJS(".btns");clipboard.on("success",function(e){e.clearSelection()}),clipboard.on("error",function(e){});
